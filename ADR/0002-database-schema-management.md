# ADR 0002: データベーススキーマ管理にFlywayを使用

## ステータス
採用

## コンテキスト
アプリケーションのデータベーススキーマを管理する方法を決定する必要があった。主な選択肢は以下の通り:
1. Spring Data JPAの自動テーブル生成（hibernate.ddl-auto=update）
2. マイグレーションツール（Flyway, Liquibase）
3. 手動SQL実行

## 決定事項
Flywayを使用してデータベースマイグレーションを管理する。

## 根拠
- **バージョン管理**: 各データベース変更をバージョン管理でき、変更履歴が明確に残る。
- **再現性**: 環境に依存せず、常に同じ順序で同じスキーマ変更を適用できる。
- **安全性**: 本番環境での自動的なスキーマ変更は危険なため、検証済みのSQLスクリプトを実行する方が安全。
- **柔軟性**: 複雑なSQLスクリプトも実行できるため、単純なテーブル作成だけでなく、データ移行なども可能。
- **テスト容易性**: テスト時には別の設定を適用し、H2などのインメモリデータベースを使用できる。

## 影響
- スキーマ変更時には必ずマイグレーションスクリプトを作成する必要がある。
- 開発者はFlywayの仕組みを理解する必要がある。
- 本番環境デプロイ前のマイグレーションスクリプトのテストが必須。
- JPA/Hibernateの自動スキーマ生成機能は使用せず、検証(validate)モードのみ使用。

## 備考
テスト環境ではFlywayを無効化し、Hibernateの自動テーブル生成(create-drop)を使用することで、テスト実行の効率を高めている。
