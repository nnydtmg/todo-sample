# ADR 0010: Logbackを使用したログ設定

## ステータス
採用

## コンテキスト
バックエンドアプリケーションにおいて、デバッグやトラブルシューティング、監視のための適切なログ記録メカニズムが必要である。また、異なる環境（開発、テスト、本番）でのログレベルや出力方法を最適化する必要がある。

## 決定事項
Spring BootのデフォルトログシステムであるLogbackを使用し、以下の特徴を持つ設定を採用する：

1. **環境別ログ設定**
   - プロファイル（local、test、prod）ごとに異なるログレベルとアペンダーを設定
   - ローカル環境：詳細なデバッグログ（DEBUG）をコンソールとファイルに出力
   - テスト環境：コンソールのみの出力
   - 本番環境：重要なログ（INFO以上）を標準出力のみに出力（コンテナ環境向け）

2. **ファイルローテーション**
   - 日次ローテーション（TimeBasedRollingPolicy）を採用
   - 30日分のログファイルを保存
   - 合計サイズ上限3GB

3. **ログフォーマット**
   - タイムスタンプ、スレッド、ログレベル、ロガー名、メッセージを含む
   - 標準出力とファイル出力で同一フォーマット
   - UTF-8エンコーディング

## 根拠
- **環境別設定**: 開発時は詳細なログが必要だが、本番環境ではパフォーマンスと運用の観点から重要なログのみを記録
- **ファイルローテーション**: 開発環境ではディスク容量の制限を考慮し、古いログを自動で整理
- **標準フォーマット**: 一貫したログ形式で検索や解析が容易
- **Spring Bootとの統合**: Springプロファイルと連携してシームレスな設定変更
- **コンテナ対応**: 本番環境では標準出力のみを使用し、12-Factor Appの原則やクラウドネイティブなログ管理と互換性を持つ設計

## 影響
- ローカル開発環境ではログファイルはlogs/ディレクトリに保存される
- 本番環境では標準出力のみを使用するため、コンテナオーケストレーションツール（Kubernetes, ECSなど）の標準的なログ収集メカニズムと互換性がある
- 複数インスタンス構成の場合、標準出力を介して外部のログ集約サービス（CloudWatch Logs, Fluentd, ELK等）に転送できる

## 備考
将来的に以下の拡張を検討:
- 構造化ログ（JSON形式）への移行
- 集中ログ管理システム（ELK、CloudWatchなど）との統合
- アラート機能の追加